    @using System.Globalization
    @using Sohba.Application.DTOs.PostAggregate
    @model IEnumerable<PostResponseDto>

    @functions {
        private string GetTimeAgo(DateTime createdAt)
        {
        var timeSpan = DateTime.UtcNow - createdAt.ToLocalTime();

            if (timeSpan.TotalSeconds < 60)
                return "Just now";
            if (timeSpan.TotalMinutes < 60)
                return $"{(int)timeSpan.TotalMinutes}m ago";
            if (timeSpan.TotalHours < 24)
                return $"{(int)timeSpan.TotalHours}h ago";
            if (timeSpan.TotalDays < 7)
                return $"{(int)timeSpan.TotalDays}d ago";
            if (timeSpan.TotalDays < 30)
                return $"{(int)(timeSpan.TotalDays / 7)}w ago";
            if (timeSpan.TotalDays < 365)
                return $"{(int)(timeSpan.TotalDays / 30)}mo ago";

            return $"{(int)(timeSpan.TotalDays / 365)}y ago";
        }

        private string GetPrivacyIcon(bool isPrivate)
        {
            return isPrivate ?
                "<svg class='w-3 h-3' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z' /></svg> Private" :
                "<svg class='w-3 h-3' fill='none' viewBox='0 0 24 24' stroke='currentColor'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z' /></svg> Public";
        }
    }
<div class="page-transition">
    @if (ViewBag.ErrorMessage != null)
    {
        <div class="bg-red-50 border border-red-200 text-red-700 px-5 py-4 rounded-2xl mb-6 flex items-center gap-3">
            <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
            </svg>
            <span class="font-medium">@ViewBag.ErrorMessage</span>
        </div>
    }

    @if (Model == null || !Model.Any())
    {
        <div class="flex flex-col items-center justify-center py-16 text-center bg-white rounded-3xl border border-dashed border-slate-200">
            <div class="bg-slate-100 p-6 rounded-3xl mb-5">
                <svg class="w-16 h-16 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                </svg>
            </div>
            <h3 class="text-xl font-bold text-slate-800 mb-2">No posts yet</h3>
            <p class="text-slate-500 text-sm max-w-xs mx-auto">Start following friends or create your first post!</p>
            <a asp-controller="Posts" asp-action="Create" class="mt-5 px-6 py-2.5 bg-[#345e69] text-white font-semibold rounded-xl hover:bg-[#2a4b55] transition-colors">
                Create Post
            </a>
        </div>
    }
    else
    {
        <div class="space-y-5">
            @foreach (var post in Model)
            {
                var menuId = $"menu-{post.Id}";
                var timeAgo = GetTimeAgo(post.CreatedAt);
                var hasImage = !string.IsNullOrEmpty(post.ImageUrl);

                <article class="bg-white rounded-3xl border border-slate-200 overflow-hidden" data-post-id="@post.Id" data-reactions="@post.ReactionsCount">

                    @* Header *@
                    <div class="p-4 sm:p-5 flex items-center justify-between">
                        <div class="flex items-center gap-3.5">
                            <div class="relative">
                                <div class="w-12 h-12 rounded-2xl overflow-hidden ring-2 ring-slate-100">
                                    <img src="https://ui-avatars.com/api/?name=@(Uri.EscapeDataString(post.AuthorName ?? "User"))&background=345e69&color=fff&size=128"
                                         class="w-full h-full object-cover"
                                         alt="@post.AuthorName"
                                         onerror="this.src='https://ui-avatars.com/api/?name=User&background=345e69&color=fff'">
                                </div>
                                <span class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 bg-emerald-500 border-2 border-white rounded-full"></span>
                            </div>

                            <div>
                                <h4 class="font-bold text-slate-800 text-sm sm:text-base">@post.AuthorName</h4>
                                <div class="flex items-center gap-2 mt-0.5 text-xs text-slate-500">
                                    <span title="@post.CreatedAt.ToString("MMM dd, yyyy HH:mm")">@timeAgo</span>
                                    <span class="w-1 h-1 bg-slate-300 rounded-full"></span>
                                    <span class="flex items-center gap-1">@Html.Raw(GetPrivacyIcon(false))</span>
                                </div>
                            </div>
                        </div>

                        @* Menu *@
                        <div class="relative">
                            <button class="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-xl" onclick="SohbaApp.toggleMenu('@menuId')">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z" />
                                </svg>
                            </button>

                            <div id="@menuId" class="hidden absolute right-0 top-11 w-52 bg-white rounded-2xl shadow-xl border border-slate-200 z-50 overflow-hidden">
                                <div class="py-1.5">
                                    <button data-save-button="@post.Id"
                                            onclick="SohbaApp.savePost('@post.Id')"
                                            class="w-full flex items-center gap-3 px-4 py-2.5 hover:bg-slate-50 text-slate-700 text-sm @(post.IsSaved ? "text-amber-600 bg-amber-50" : "")">
                                        <svg class="w-5 h-5" fill="@(post.IsSaved ? "currentColor" : "none")" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
                                        </svg>
                                    <span class="btn-text">
                                        @(post.IsSaved ? "Saved" : "Save Post")
                                    </span>
                                    </button>

                                    <button data-fav-button="@post.Id"
                                            onclick="SohbaApp.addToFavorites('@post.Id')"
                                            class="w-full flex items-center gap-3 px-4 py-2.5 hover:bg-slate-50 text-slate-700 text-sm @(post.IsFavorite ? "text-pink-600 bg-pink-50" : "")">
                                        <svg class="w-5 h-5" fill="@(post.IsFavorite ? "currentColor" : "none")" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                        </svg>
                                    <span class="btn-text">
                                        @(post.IsFavorite ? "Favorited" : "Add to Favorites")
                                    </span>
                                    </button>
                                    <hr class="border-slate-100 my-1">
                                    
                                    <button data-report-button="@post.Id"
                                            onclick="SohbaApp.reportPost('@post.Id')"
                                            class="w-full flex items-center gap-3 px-4 py-2.5 hover:bg-red-50 text-red-600 text-sm @(post.IsReportedByCurrentUser ? "opacity-50 cursor-not-allowed" : "")"
                                            @(post.IsReportedByCurrentUser ? "disabled" : "")>

                                        @if (post.IsReportedByCurrentUser)
                                        {
                                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                            </svg>
                                            <span>Reported</span>
                                        }
                                        else
                                        {
                                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                            </svg>
                                            <span>Report Post</span>
                                        }
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    @* Content *@
                    <div class="px-4 sm:px-5 pb-3">
                        <h3 class="font-bold text-slate-800 text-lg mb-2">@post.Title</h3>
                        <p class="text-slate-600 leading-relaxed text-sm sm:text-base whitespace-pre-line">@post.Content</p>
                    </div>

                    @* Media *@
                    @if (hasImage)
                    {
                        <div class="mt-2 bg-slate-100 cursor-pointer" onclick="SohbaApp.openPostModal('@post.Id')">
                            <div class="aspect-[16/9] overflow-hidden">
                                <img src="@post.ImageUrl"
                                     class="w-full h-full object-cover"
                                     alt="Post image"
                                     loading="lazy"
                                     onerror="this.style.display='none'">
                            </div>
                        </div>
                    }

                    @* Engagement Stats *@
                    <div class="px-4 sm:px-5 py-3 flex items-center justify-between border-b border-slate-100">
                        <div class="flex items-center gap-1.5">
                            <div class="flex -space-x-1.5">
                                <span class="w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center text-white text-[8px] border border-white">👍</span>
                                <span class="w-5 h-5 rounded-full bg-red-500 flex items-center justify-center text-white text-[8px] border border-white">❤️</span>
                                @if (post.ReactionsCount > 2)
                                {
                                    <span class="w-5 h-5 rounded-full bg-slate-200 flex items-center justify-center text-[8px] text-slate-600 border border-white font-bold">+@(post.ReactionsCount - 2)</span>
                                }
                            </div>
                            <span class="text-xs text-slate-500 font-medium reaction-count-@post.Id">
                                @post.ReactionsCount @(post.ReactionsCount == 1 ? "reaction" : "reactions")
                            </span>
                        </div>

                        <div class="flex items-center gap-4 text-xs text-slate-500">
                            <button onclick="SohbaApp.openPostModal('@post.Id', 'comments')"
                                    class="hover:text-[#345e69]">

                                <span id="comments-count-@post.Id">
                                    @post.CommentsCount
                                </span>

                                <span id="comments-label-@post.Id">
                                    @(post.CommentsCount == 1 ? "comment" : "comments")
                                </span>

                            </button>


                            <span class="w-1 h-1 bg-slate-300 rounded-full"></span>
                            <span>0 shares</span> @* Will be dynamic later *@
                        </div>
                    </div>

                    @* Action Buttons *@
                    <div class="px-2 py-1.5 flex items-center justify-between">
                        <div class="flex-1 relative">
                            @{
                                var currentReaction = post.CurrentUserReaction; 
                                var likeIcon = currentReaction switch
                                {
                                    "Like" => "👍",
                                    "Love" => "❤️",
                                    "Haha" => "😂",
                                    "Wow" => "😮",
                                    "Sad" => "😢",
                                    "Angry" => "😠",
                                    _ => "👍"
                                };
                                var likeText = currentReaction ?? "Like";
                                var likeColor = currentReaction != null ? "text-blue-600" : "text-slate-600";
                            }

                            <button data-like-button="@post.Id"
                                    data-current-reaction="@currentReaction"
                                    onclick="SohbaApp.toggleReactionPicker('@post.Id')"
                                    class="w-full flex items-center justify-center gap-2 py-2.5 rounded-xl hover:bg-slate-50 @likeColor transition-colors">
                                <span class="like-icon">@likeIcon</span>
                                <span class="like-text font-semibold text-sm">@likeText</span>
                            </button>


                            <div id="reaction-picker-@post.Id" class="hidden absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-2 bg-white rounded-2xl shadow-xl border border-slate-200 flex items-center gap-1 z-20">
                                <button onclick="SohbaApp.reactToPost('@post.Id', 'Like')" class="p-2 hover:scale-110 transition text-2xl" title="Like">👍</button>
                                <button onclick="SohbaApp.reactToPost('@post.Id', 'Love')" class="p-2 hover:scale-110 transition text-2xl" title="Love">❤️</button>
                                <button onclick="SohbaApp.reactToPost('@post.Id', 'Haha')" class="p-2 hover:scale-110 transition text-2xl" title="Haha">😂</button>
                                <button onclick="SohbaApp.reactToPost('@post.Id', 'Wow')" class="p-2 hover:scale-110 transition text-2xl" title="Wow">😮</button>
                                <button onclick="SohbaApp.reactToPost('@post.Id', 'Sad')" class="p-2 hover:scale-110 transition text-2xl" title="Sad">😢</button>
                                <button onclick="SohbaApp.reactToPost('@post.Id', 'Angry')" class="p-2 hover:scale-110 transition text-2xl" title="Angry">😠</button>
                            </div>
                        </div>

                        <button onclick="SohbaApp.openPostModal('@post.Id', 'comments')" class="flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl hover:bg-slate-50 text-slate-600 transition-colors">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                            </svg>
                            <span class="font-semibold text-sm">Comment</span>
                        </button>

                        <button onclick="SohbaApp.sharePost('@post.Id')" class="flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl hover:bg-slate-50 text-slate-600 transition-colors">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                            </svg>
                            <span class="font-semibold text-sm">Share</span>
                        </button>
                    </div>
                </article>
            }
        </div>
    }

    @* Modern Post Modal (Instagram Style) *@
    <div id="postModal" class="fixed inset-0 z-50 hidden">
        <!-- Overlay -->
        <div class="absolute inset-0 bg-black/60" onclick="SohbaApp.closePostModal()"></div>

        <!-- Modal Container -->
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-7xl h-[90vh] rounded-2xl shadow-2xl flex flex-col md:flex-row overflow-hidden overflow-x-hidden">

                <!-- Left: Image Section -->
                <div id="modalLeft"  class="flex-1 bg-black flex items-center justify-center">
                    <img id="modalPostImage" class="w-full h-full object-cover" src="" alt="Post image">
                </div>

                <!-- Right: Details Section -->
                <div id="modalRight"  class="w-96 flex-shrink-0 flex flex-col bg-white">
            

                    <!-- Header: User Info -->
                    <div class="flex items-center gap-3 p-4 border-b">
                        <img id="modalAuthorAvatar" class="w-10 h-10 rounded-full object-cover" src="">
                        <div>
                            <h3 id="modalAuthorName" class="font-semibold text-gray-900"></h3>
                            <p id="modalPostDate" class="text-xs text-gray-500"></p>
                        </div>
                        <button onclick="SohbaApp.closePostModal()" class="ml-auto p-1 text-gray-400 hover:text-gray-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>

                    <!-- Comments Section (Scrollable) -->
                    <div id="modalComments" class="flex-1 overflow-y-auto p-4 space-y-4">
                        <!-- Comments will be injected here -->
                    </div>

                    <!-- Post Content (if no image) -->
                    <div id="modalPostContent" class="px-4 pb-2 text-gray-800"></div>

                    @* <!-- Action Icons (Like, Comment, Share) -->
                    <div class="flex items-center gap-4 px-4 py-2 border-t">
                        <button class="text-gray-600 hover:text-blue-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                            </svg>
                        </button>
                        <button class="text-gray-600 hover:text-blue-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                            </svg>
                        </button>
                        <button class="text-gray-600 hover:text-blue-600">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                            </svg>
                        </button>
                    </div> *@

                    <!-- Comment Input -->
                    <div class="p-4 border-t flex gap-2">
                        <input id="commentInput" type="text" placeholder="Add a comment..." class="flex-1 border rounded-full px-4 py-2 focus:outline-none focus:border-[#345e69]">
                        <button onclick="SohbaApp.submitComment()" class="bg-[#345e69] text-white px-5 py-2 rounded-full font-semibold hover:bg-[#2a4b55] transition">Post</button>
                    </div>
                </div>
            </div>
        </div>
    </div>



    @Html.AntiForgeryToken()
    <!-- Report Post Modal -->
    <div id="reportModal" class="fixed inset-0 z-[100] hidden">
        <!-- Overlay -->
        <div class="absolute inset-0 bg-black/60" onclick="SohbaApp.closeReportModal()"></div>

        <!-- Modal Container -->
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden">

                <!-- Header -->
                <div class="flex items-center justify-between p-4 border-b">
                    <h3 class="text-lg font-bold text-gray-900">Report Post</h3>
                    <button onclick="SohbaApp.closeReportModal()" class="p-1 text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <!-- Content -->
                <div class="p-4">
                    <p class="text-sm text-gray-600 mb-4">Why are you reporting this post? Your report is anonymous.</p>

                    <div class="space-y-3">
                        <!-- Spam -->
                        <label class="flex items-center p-3 border rounded-xl cursor-pointer hover:bg-slate-50 transition-colors">
                            <input type="radio" name="reportReason" value="Spam" class="w-4 h-4 text-[#345e69] focus:ring-[#345e69]">
                            <span class="ml-3 text-sm font-medium text-gray-700">Spam</span>
                        </label>

                        <!-- Harassment -->
                        <label class="flex items-center p-3 border rounded-xl cursor-pointer hover:bg-slate-50 transition-colors">
                            <input type="radio" name="reportReason" value="Harassment" class="w-4 h-4 text-[#345e69] focus:ring-[#345e69]">
                            <span class="ml-3 text-sm font-medium text-gray-700">Harassment or bullying</span>
                        </label>

                        <!-- Inappropriate Content -->
                        <label class="flex items-center p-3 border rounded-xl cursor-pointer hover:bg-slate-50 transition-colors">
                            <input type="radio" name="reportReason" value="InappropriateContent" class="w-4 h-4 text-[#345e69] focus:ring-[#345e69]">
                            <span class="ml-3 text-sm font-medium text-gray-700">Inappropriate content</span>
                        </label>

                        <!-- Violence -->
                        <label class="flex items-center p-3 border rounded-xl cursor-pointer hover:bg-slate-50 transition-colors">
                            <input type="radio" name="reportReason" value="Violence" class="w-4 h-4 text-[#345e69] focus:ring-[#345e69]">
                            <span class="ml-3 text-sm font-medium text-gray-700">Violence or dangerous organizations</span>
                        </label>

                        <!-- Other -->
                        <label class="flex items-center p-3 border rounded-xl cursor-pointer hover:bg-slate-50 transition-colors">
                            <input type="radio" name="reportReason" value="Other" class="w-4 h-4 text-[#345e69] focus:ring-[#345e69]">
                            <span class="ml-3 text-sm font-medium text-gray-700">Something else</span>
                        </label>
                    </div>

                    <!-- Additional info (ظهر بس لو اختار Other) -->
                    <div id="otherReasonContainer" class="mt-4 hidden">
                        <textarea id="otherReasonText" rows="3" placeholder="Please describe the issue..."
                                  class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#345e69]/20 focus:border-[#345e69] transition-all"></textarea>
                    </div>
                </div>

                <!-- Footer -->
                <div class="flex gap-3 p-4 border-t bg-slate-50">
                    <button onclick="SohbaApp.closeReportModal()"
                            class="flex-1 py-2.5 border border-gray-200 text-gray-600 font-semibold rounded-xl hover:bg-gray-100 transition-colors">
                        Cancel
                    </button>
                    <button onclick="SohbaApp.submitReport()"
                            class="flex-1 py-2.5 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-xl shadow-lg shadow-red-600/30 transition-colors">
                        Submit Report
                    </button>
                </div>
            </div>
        </div>
    </div>






    <!-- Share Post Modal -->
    <div id="shareModal" class="fixed inset-0 z-[100] hidden">
        <!-- Overlay -->
        <div class="absolute inset-0 bg-black/60" onclick="SohbaApp.closeShareModal()"></div>

        <!-- Modal Container -->
        <div class="absolute inset-0 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden">
                <!-- Header -->
                <div class="flex items-center justify-between p-4 border-b">
                    <h3 class="text-lg font-bold text-gray-900">Share Post</h3>
                    <button onclick="SohbaApp.closeShareModal()" class="p-1 text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <!-- Content -->
                <div class="p-6">
                    <p class="text-sm text-gray-600 mb-3">Share this post with others</p>

                    <!-- Post URL -->
                    <div class="flex items-center gap-2 mb-4">
                        <input id="sharePostUrl" type="text" readonly
                               class="flex-1 px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none"
                               value="">
                        <button onclick="SohbaApp.copyShareLink()"
                                class="px-4 py-3 bg-[#345e69] text-white font-semibold rounded-xl hover:bg-[#2a4b55] transition-colors flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                            </svg>
                            Copy
                        </button>
                    </div>

                    <!-- Social Share Options (اختياري) -->
                    <div class="flex justify-center gap-4 mt-4">
                        <button class="p-3 bg-blue-600 text-white rounded-full hover:scale-110 transition-transform" title="Share on Facebook">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" />
                            </svg>
                        </button>
                        <button class="p-3 bg-sky-500 text-white rounded-full hover:scale-110 transition-transform" title="Share on Twitter">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" />
                            </svg>
                        </button>
                        <button class="p-3 bg-green-600 text-white rounded-full hover:scale-110 transition-transform" title="Share on WhatsApp">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12c0 1.9.53 3.68 1.45 5.2L2.3 21.3c-.1.4.2.8.6.6l4.1-1.4C8.4 21.4 10.1 22 12 22c5.52 0 10-4.48 10-10S17.52 2 12 2zm0 18c-1.5 0-2.9-.4-4.1-1.1l-.3-.2-3.1 1.1 1.1-3.1-.2-.3c-.7-1.2-1.1-2.6-1.1-4.1 0-4.4 3.6-8 8-8s8 3.6 8 8-3.6 8-8 8zm4.5-6.5c-.2-.1-1.4-.7-1.6-.8-.2-.1-.4-.1-.5.1-.2.2-.6.8-.7 1-.1.2-.2.2-.4.1-1.5-.7-2.5-1.3-3.5-2.3-.3-.3-.5-.5-.7-.8-.1-.2 0-.4.1-.5.1-.1.2-.2.3-.3.1-.1.2-.2.2-.3.1-.2 0-.4 0-.5-.1-.2-.5-1.1-.6-1.5-.2-.4-.4-.4-.5-.4h-.5c-.2 0-.4.1-.6.3-.8.8-1.2 1.8-1.1 2.9.1 1.1.5 2.1 1.2 3 .7.9 1.6 1.6 2.7 2 .5.2 1 .3 1.5.3.6 0 1.1-.2 1.5-.5.3-.3.5-.6.6-1 .1-.3 0-.5-.1-.6-.1-.1-.2-.1-.3-.2z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    @*-----------------------------------------------------------------------*@

    


</div>

    <script>
        (function() {
            console.log('PostCard script executing...');

            // التأكد من وجود الكائن العام
            window.SohbaApp = window.SohbaApp || {};

            // تعريف الدوال مباشرة على window.SohbaApp
            window.SohbaApp.toggleMenu = function(menuId) {
                console.log('toggleMenu called with', menuId);
                const menu = document.getElementById(menuId);
                if (!menu) return;
                document.querySelectorAll('[id^="menu-"]').forEach(m => m.classList.add('hidden'));
                menu.classList.toggle('hidden');
            };

             // ------------ Toggle To Reaction Picker -------------

            window.SohbaApp.toggleReactionPicker = function(postId) {
                const button = document.querySelector(`[data-like-button="${postId}"]`);
                if (button.dataset.currentReaction) {
                    window.SohbaApp.reactToPost(postId, button.dataset.currentReaction);
                    return;
                }
                const picker = document.getElementById(`reaction-picker-${postId}`);
                if (!picker) return;
                document.querySelectorAll('[id^="reaction-picker-"]').forEach(p => p.classList.add('hidden'));
                picker.classList.toggle('hidden');
            };


                // ------------ React To Post -------------
            window.SohbaApp.reactToPost = async function(postId, reactionType) {

                    document.getElementById(`reaction-picker-${postId}`)?.classList.add('hidden');

                    try {
                        const response = await fetch('/Posts/React', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ postId, reactionType })
                        });

                        const result = await response.json();

                        if (!result.success) {
                            window.SohbaApp.toast(result.error || 'Failed', 'error');
                            return;
                        }

                        const button = document.querySelector(`[data-like-button="${postId}"]`);
                        const icon = button.querySelector('.like-icon');
                        const text = button.querySelector('.like-text');

                        const map = {
                            Like: { icon: '👍', color: 'text-blue-600' },
                            Love: { icon: '❤️', color: 'text-red-500' },
                            Haha: { icon: '😂', color: 'text-yellow-500' },
                            Wow:  { icon: '😮', color: 'text-yellow-500' },
                            Sad:  { icon: '😢', color: 'text-yellow-500' },
                            Angry:{ icon: '😠', color: 'text-orange-600' }
                        };

                        if (result.action === 'added') {

                            window.SohbaApp.toast('Reaction added!', 'success');
                            button.dataset.currentReaction = result.reactionType;

                            const r = map[result.reactionType];

                            icon.innerText = r.icon;
                            text.innerText = result.reactionType;

                            button.classList.remove('text-slate-600');
                            button.classList.add(r.color);

                        } else if (result.action === 'removed') {
                            window.SohbaApp.toast('Reaction removed!', 'success');
                            button.dataset.currentReaction = '';

                            icon.innerText = '👍';
                            text.innerText = 'Like';

                            button.classList.remove(
                                'text-blue-600',
                                'text-red-500',
                                'text-yellow-500',
                                'text-orange-600'
                            );

                            button.classList.add('text-slate-600');
                        }

                        const countSpan = document.querySelector(`.reaction-count-${postId}`);
                        if (countSpan && result.newCount !== undefined) {
                            countSpan.innerText = result.newCount + ' reactions';
                        }

                    } catch (e) {
                        console.error(e);
                        window.SohbaApp.toast('Network error', 'error');
                    }
            };


                // ------------ Open Post Modal (Instagram Style) -------------
        window.SohbaApp.openPostModal = async function(postId, focusTab = null) {
                console.log('openPostModal called with', postId, focusTab);
                const modal = document.getElementById('postModal');
                if (!modal) return;

                modal.classList.remove('hidden');
                modal.dataset.postId = postId;
                document.body.style.overflow = 'hidden';

                // Clear previous content
                document.getElementById('modalPostImage').src = '';
                document.getElementById('modalAuthorName').innerText = '';
                document.getElementById('modalPostDate').innerText = '';
                document.getElementById('modalPostContent').innerText = '';
                document.getElementById('modalComments').innerHTML = '<p class="text-slate-400 text-sm italic">Loading comments...</p>';
                document.getElementById('modalAuthorAvatar').src = '';

                try {
                    const response = await fetch(`/Posts/GetPostDetails?postId=${postId}`);
                    if (!response.ok) throw new Error('Failed to load');
                    const data = await response.json();

                    // Reset layout to default first
                    const modalContainer = document.querySelector('#postModal .flex-col.md\\:flex-row');
                    const leftSide = document.getElementById('modalLeft');
                    const rightSide = document.getElementById('modalRight');

                    // إعادة تعيين الكلاسات والحالة الافتراضية
                    if (leftSide) leftSide.style.display = '';
                    if (rightSide) {
                        rightSide.classList.remove('w-full');
                        rightSide.classList.add('w-96');
                    }
                    modalContainer.style.justifyContent = 'flex-start'; // الرجوع للوضع الافتراضي

                    // Set image
                    if (data.post.imageUrl) {
                        document.getElementById('modalPostImage').src = data.post.imageUrl;
                    } else {
                        // Hide left side if no image
                        if (leftSide) leftSide.style.display = 'none';
                        if (rightSide) {
                            rightSide.classList.remove('w-96');
                            rightSide.classList.add('w-full');
                        }
                        // وسّط المحتوى في المودال
                        modalContainer.style.justifyContent = 'center';
                    }

                    // User info
                    const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(data.post.authorName)}&background=345e69&color=fff`;
                    document.getElementById('modalAuthorAvatar').src = avatarUrl;
                    document.getElementById('modalAuthorName').innerText = data.post.authorName;
                    document.getElementById('modalPostDate').innerText = new Date(data.post.createdAt).toLocaleString();
                    document.getElementById('modalPostContent').innerText = data.post.content;

                    // Comments with See More/See Less toggle
                    if (data.comments && data.comments.length > 0) {
                        const commentsHtml = data.comments.map(c => {
                            const commentId = `comment-${c.id}`;
                            const fullContent = c.content;
                            const maxLength = 100;
                            const shouldTruncate = fullContent.length > maxLength;
                            const shortContent = shouldTruncate ? fullContent.substring(0, maxLength) + '...' : fullContent;

                            return `
                                <div class="flex items-start gap-3 mb-3">
                                    <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(c.userName)}&background=random" class="w-8 h-8 rounded-full flex-shrink-0">
                                    <div class="flex-1 min-w-0">
                                        <span class="font-semibold text-sm text-gray-900">${c.userName}</span>
                                        <div id="${commentId}" class="text-sm text-gray-700 break-words">
                                            ${shortContent}
                                        </div>
                                        ${shouldTruncate ? `
                                            <button class="text-blue-600 hover:underline text-xs mt-1 toggle-comment-btn"
                                                    onclick="SohbaApp.toggleComment('${commentId}', '${fullContent.replace(/'/g, "\\'")}', '${shortContent.replace(/'/g, "\\'")}')">
                                                See more
                                            </button>
                                        ` : ''}
                                        <span class="text-xs text-gray-400 block mt-1">${new Date(c.createdAt).toLocaleString()}</span>
                                    </div>
                                </div>
                            `;
                        }).join('');
                        document.getElementById('modalComments').innerHTML = commentsHtml;
                    } else {
                        document.getElementById('modalComments').innerHTML = '<p class="text-slate-400 text-sm italic">No comments yet.</p>';
                    }

                    if (focusTab === 'comments') {
                        setTimeout(() => document.getElementById('commentInput')?.focus(), 300);
                    }
                } catch (error) {
                    console.error('Error loading post:', error);
                    window.SohbaApp.toast('Failed to load post', 'error');
                    window.SohbaApp.closePostModal();
                }
            };

                // ---- -------- Toggle Comment Content (See More / See Less) -------------
                window.SohbaApp.toggleComment = function(commentId, fullText, shortText) {
                    const commentDiv = document.getElementById(commentId);
                    const button = commentDiv?.nextElementSibling;

                    if (!commentDiv || !button || button.tagName !== 'BUTTON') return;

                    const isExpanded = commentDiv.innerText === fullText;

                    if (isExpanded) {
                        // Collapse
                        commentDiv.innerText = shortText;
                        button.innerText = 'See more';
                    } else {
                        // Expand
                        commentDiv.innerText = fullText;
                        button.innerText = 'See less';
                    }
                };

             // ------------ Close Modal -------------
            window.SohbaApp.closePostModal = function() {
                document.getElementById('postModal')?.classList.add('hidden');
                document.body.style.overflow = '';
            };

            // ------------ Close Modal When Click Outside ---------------
            document.addEventListener('click', function(e) {
                const modal = document.getElementById('postModal');
                if (modal && !modal.classList.contains('hidden')) {
                    if (!e.target.closest('.bg-white')) {
                        window.SohbaApp.closePostModal();
                    }
                }
            });

               // ------------ Submit Comment -------------
            window.SohbaApp.submitComment = async function() {
                const modal = document.getElementById('postModal');
                const postId = modal.dataset.postId;
                const input = document.getElementById('commentInput');
                const content = input.value.trim();

                if (!content) return;

                try {
                    const response = await fetch('/Posts/Comment', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ postId, content })
                    });
                    const result = await response.json();

                    if (!result.success) {
                        window.SohbaApp.toast(result.error || 'Failed', 'error');
                        return;
                    }

                    // Add new comment to the top
                    const commentHtml = `
                        <div class="flex items-start gap-3">
                            <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(result.comment.userName)}&background=random" class="w-8 h-8 rounded-full">
                            <div class="flex-1">
                                <span class="font-semibold text-sm">${result.comment.userName}</span>
                                <p class="text-sm text-gray-700">${result.comment.content}</p>
                                <span class="text-xs text-gray-400">${new Date(result.comment.createdAt).toLocaleString()}</span>
                            </div>
                        </div>
                    `;
                    document.getElementById('modalComments').insertAdjacentHTML('afterbegin', commentHtml);
                    input.value = '';

                    // Update comment count in the original post card
                    const countSpan = document.getElementById(`comments-count-${postId}`);
                    if (countSpan) {
                        const newCount = parseInt(countSpan.innerText) + 1;
                        countSpan.innerText = newCount;
                        const labelSpan = document.getElementById(`comments-label-${postId}`);
                        if (labelSpan) labelSpan.innerText = newCount === 1 ? 'comment' : 'comments';
                    }
                    window.SohbaApp.toast('Comment posted!', 'success');

                } catch (e) {
                    console.error(e);
                    window.SohbaApp.toast('Network error', 'error');
                }
            };

            //-----------------------------------------------------------------------------------------------
            // ------------ Save Post -------------
              window.SohbaApp.savePost = async function(postId) {
                    try {
                        const result = await window.SohbaApp.post('/Posts/ToggleSavePost', {
                            postId: postId,
                            isFavorite: false
                        });

                        if (result.success) {
                            // تحديث واجهة الزر
                            const button = document.querySelector(`[data-save-button="${postId}"]`);
                            const icon = button.querySelector('svg');
                            const text = button.querySelector('.btn-text');

                            if (result.saved) {
                                button.classList.add('text-amber-600', 'bg-amber-50');
                                icon.setAttribute('fill', 'currentColor');
                                text.textContent = 'Saved';
                            } else {
                                button.classList.remove('text-amber-600', 'bg-amber-50');
                                icon.setAttribute('fill', 'none');
                                text.textContent = 'Save Post';
                            }

                            window.SohbaApp.toast(result.message, 'success');
                        } else {
                            window.SohbaApp.toast(result.error || 'Failed to save post', 'error');
                        }
                    } catch (error) {
                        console.error('Save error:', error);
                        window.SohbaApp.toast('Network error', 'error');
                    }
                };
            //-----------------------------------------------------------------------------------------------



            // ------------ Add to Favorites -------------
                 window.SohbaApp.addToFavorites = async function(postId) {
                        try {
                            const result = await window.SohbaApp.post('/Posts/ToggleSavePost', {
                                postId: postId,
                                isFavorite: true
                            });

                            if (result.success) {
                                const button = document.querySelector(`[data-fav-button="${postId}"]`);
                                const icon = button.querySelector('svg');
                                const text = button.querySelector('.btn-text');

                                if (result.saved) {
                                    button.classList.add('text-pink-600', 'bg-pink-50');
                                    icon.setAttribute('fill', 'currentColor');
                                    text.textContent = 'Favorited';
                                } else {
                                    button.classList.remove('text-pink-600', 'bg-pink-50');
                                    icon.setAttribute('fill', 'none');
                                    text.textContent = 'Add to Favorites';
                                }

                                window.SohbaApp.toast(result.message, 'success');
                            } else {
                                window.SohbaApp.toast(result.error || 'Failed to add to favorites', 'error');
                            }
                        } catch (error) {
                            console.error('Favorite error:', error);
                            window.SohbaApp.toast('Network error', 'error');
                        }
                    };

            //-----------------------------------------------------------------------------------------------


                // ------------ Toggle Save / Favorite -------------
        async function toggleSave(postId, isFavorite) {
            try {
                const response = await fetch('/Posts/ToggleSavePost', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value
                    },
                    body: JSON.stringify({ postId, isFavorite })
                });
                const result = await response.json();

                if (result.success) {
                    // تحديث حالة الزر
                    const button = isFavorite
                                        ? document.querySelector(`[data-fav-button="${postId}"]`)
                                        : document.querySelector(`[data-save-button="${postId}"]`);


                    if (button) {
                        const icon = button.querySelector('svg');
                    const text = button.querySelector('.btn-text');

                        if (result.saved) {
                            // تمت الإضافة
                            button.classList.add(isFavorite ? 'text-pink-600' : 'text-amber-600');
                            button.classList.add(isFavorite ? 'bg-pink-50' : 'bg-amber-50');
                            icon.setAttribute('fill', 'currentColor');
                            text.textContent = isFavorite ? 'Favorited' : 'Saved';
                        } else {
                            // تمت الإزالة
                            button.classList.remove(isFavorite ? 'text-pink-600' : 'text-amber-600');
                            button.classList.remove(isFavorite ? 'bg-pink-50' : 'bg-amber-50');
                            icon.setAttribute('fill', 'none');
                            text.textContent = isFavorite ? 'Add to Favorites' : 'Save Post';
                        }
                    }

                    window.SohbaApp.toast(result.message, 'success');
                } else {
                    window.SohbaApp.toast(result.error || 'Operation failed', 'error');
                }
            } catch (e) {
                console.error(e);
                window.SohbaApp.toast('Network error', 'error');
            }
        }

            // ------------ Report Post Modal -------------
        

        window.SohbaApp.openReportModal = function(postId) {
           const modal = document.getElementById('reportModal');
            modal.dataset.postId = postId;
            
            document.querySelectorAll('input[name="reportReason"]').forEach(radio => {
                radio.checked = false;
            });

            document.getElementById('otherReasonContainer').classList.add('hidden');
            document.getElementById('otherReasonText').value = '';

            document.getElementById('reportModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        };

        window.SohbaApp.closeReportModal = function() {
            const modal = document.getElementById('reportModal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
            delete modal.dataset.postId;
        };

             window.SohbaApp.submitReport = async function() {
                    const selectedRadio = document.querySelector('input[name="reportReason"]:checked');
                    if (!selectedRadio) {
                        window.SohbaApp.toast('Please select a reason for reporting', 'error');
                        return;
                    }

                    let reason = selectedRadio.value;
                    let additionalInfo = '';

                    if (reason === 'Other') {
                        additionalInfo = document.getElementById('otherReasonText').value.trim();
                        if (!additionalInfo) {
                            window.SohbaApp.toast('Please describe the issue', 'error');
                            return;
                        }
                    }

                    try {
                        const modal = document.getElementById('reportModal');
                        const postId = modal.dataset.postId;

                        const result = await window.SohbaApp.post('/Posts/ReportPost', {
                            postId: postId,
                            reason: reason,
                            additionalInfo: additionalInfo
                        });

                        if (result.success) {
                            window.SohbaApp.closeReportModal();

                            // تحديث الزر
                            const reportButton = document.querySelector(`[data-report-button="${postId}"]`);
                            if (reportButton) {
                                reportButton.disabled = true;
                                reportButton.classList.add('opacity-50', 'cursor-not-allowed');
                                reportButton.innerHTML = `
                                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    <span>Reported</span>
                                `;
                            }

                            window.SohbaApp.toast('Post reported successfully. Thank you!', 'success');
                        } else {
                            window.SohbaApp.toast(result.error || 'Failed to report post', 'error');
                        }
                    } catch (e) {
                        console.error(e);
                        window.SohbaApp.toast('Network error', 'error');
                    }
                };

        // تحديث دالة reportPost القديمة
        window.SohbaApp.reportPost = function(postId) {
            window.SohbaApp.openReportModal(postId);
        };

        window.SohbaApp.sharePost = function(postId) {
            console.log('sharePost called with', postId);
            window.SohbaApp.toast('Share feature coming soon!', 'info');
        };

        // ----------------

            // ------------ Share Modal Functions -------------
            window.SohbaApp.openShareModal = function(postId) {
                const modal = document.getElementById('shareModal');
                if (!modal) return;

                modal.dataset.postId = postId;
                const baseUrl = window.location.origin;
                const postUrl = `${baseUrl}/Posts/Details/${postId}`;
                document.getElementById('sharePostUrl').value = postUrl;

                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            };

            window.SohbaApp.closeShareModal = function() {
                const modal = document.getElementById('shareModal');
                if (!modal) return;
                modal.classList.add('hidden');
                document.body.style.overflow = '';
                delete modal.dataset.postId;
            };

            window.SohbaApp.copyShareLink = function() {
                const urlInput = document.getElementById('sharePostUrl');
                urlInput.select();
                urlInput.setSelectionRange(0, 99999); // For mobile devices
                navigator.clipboard.writeText(urlInput.value).then(() => {
                    window.SohbaApp.toast('Link copied to clipboard!', 'success');
                }).catch(() => {
                    window.SohbaApp.toast('Failed to copy', 'error');
                });
            };

            // تعديل دالة sharePost الموجودة
            window.SohbaApp.sharePost = function(postId) {
                console.log('sharePost called with', postId);
                window.SohbaApp.openShareModal(postId);
            };

            //----------------------------------------------------------

               
















        // ---------------------------------

        // مستمع عام لإغلاق القوائم عند النقر خارجها
        document.addEventListener('click', function(e) {
            if (!e.target.closest('[id^="menu-"]') && !e.target.closest('button[onclick*="toggleMenu"]')) {
                document.querySelectorAll('[id^="menu-"]').forEach(menu => menu.classList.add('hidden'));
            }
            if (!e.target.closest('[id^="reaction-picker-"]') && !e.target.closest('button[onclick*="toggleReactionPicker"]')) {
                document.querySelectorAll('[id^="reaction-picker-"]').forEach(picker => picker.classList.add('hidden'));
            }
        });

        // إغلاق المودال بـ Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                window.SohbaApp.closePostModal?.();
            }
        });

        // Show/hide other reason field
        document.querySelectorAll('input[name="reportReason"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const otherContainer = document.getElementById('otherReasonContainer');
                if (this.value === 'Other') {
                    otherContainer.classList.remove('hidden');
                } else {
                    otherContainer.classList.add('hidden');
                }
            });
        });

        // ---------- Toaster Notification ---------------
        window.SohbaApp.toast = function(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `fixed bottom-5 right-5 px-4 py-2 rounded-lg text-white shadow-lg z-[10000] transition-opacity duration-300 ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500'}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        };

    
            console.log('All PostCard functions added to SohbaApp');
        })();
    </script>